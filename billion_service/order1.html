<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<script src="js/fit.js"></script>
		<title>我的订单</title>
		<link rel="stylesheet" href="css/reset.css" />
		<link rel="stylesheet" href="css/comm.css" />
		<link rel="stylesheet" type="text/css" href="css/order.css" />
		<link rel="stylesheet" href="css/swiper-3.4.2.min.css" />
		<style type="text/css">
			html,
			body {
				height: 100%;
				font-family: "微软雅黑";
			}
			
			.padd_40 {
				overflow-x: hidden;
			}
			
			.refreshtip {
				position: absolute;
				left: 0;
				width: 100%;
				margin: 10px 0;
				text-align: center;
				color: #999;
			}
			
			.swiper-container {
				overflow: visible;
				margin-top: 0.8rem;
			}
			
			.loadtip {
				display: block;
				width: 100%;
				line-height: 40px;
				height: 40px;
				text-align: center;
				color: #999;
				border-top: 1px solid #ddd;
			}
			
			.swiper-container,
			.w {
				height: calc(100vh - 120px);
			}
			
			.swiper-slide {
				height: auto;
			}
			
			.text-center {
				text-align: center;
			}
			
			.list-group {
				padding-left: 0;
				margin-bottom: 20px;
			}
			
			.list-group-item {
				position: relative;
				display: block;
				padding: 10px 15px;
				margin-bottom: -1px;
				background-color: #fff;
				border: 1px solid #ddd;
			}
			
			.list-group-item:first-child {
				border-top-left-radius: 4px;
				border-top-right-radius: 4px;
			}
		</style>
	</head>

	<body class="padd_40">
		<div class="o_tab">
			<ul>
				<li class="active"><span>全部</span></li>
				<li><span>待付款</span></li>
				<li><span>已完成</span></li>
			</ul>
		</div>
		<div class="swiper-container">
			<!--<div class="refreshtip">下拉可以刷新</div>-->
			<div class="swiper-wrapper w">
				<div class="swiper-slide d">
					<div class="init-loading list-group-item text-center" style="display: none;">下拉可以刷新</div>
					<div class="swiper-container2">
						<div class="swiper-wrapper">
							<div class="swiper-slide list-group">
								<div class="list-group-item">
									<div class="order">
										<div class="order_info">
											<div class="left">
												<p>订单编号：<span>12345678</span></p>
												<p>下单时间：<span>2017-7-8</span></p>
											</div>
											<a class="right" href="javascript:;">等待付款</a>
											<div class="del">
												<img src="img/del.png" alt="" />
											</div>
										</div>
										<div class="pro_list">
											<div class="order_pro">
												<div class="img">
													<img src="img/1.png" alt="" />
												</div>

												<div class="text">
													<h4>腾讯云服务</h4>
													<p>安全稳定，高弹性的计算机服务，给您提供更高效的体验</p>
													<p style="color: #2BC1FF;">
														￥<span class="price">688.00</span>
													</p>
												</div>
											</div>
										</div>

										<div class="pay">
											<span>共1件商品 需付款￥788.00</span>
											<a href="account.html">立即付款</a>
										</div>
									</div>
								</div>

							</div>
							<div class="swiper-slide list-group">
								<div class="list-group-item">
									<div class="order">
										<div class="order_info">
											<div class="left">
												<p>订单编号：<span>12345678</span></p>
												<p>下单时间：<span>2017-7-8</span></p>
											</div>
											<a class="right" href="javascript:;">等待付款</a>
											<div class="del">
												<img src="img/del.png" alt="" />
											</div>
										</div>
										<div class="pro_list">
											<div class="order_pro">
												<div class="img">
													<img src="img/1.png" alt="" />
												</div>

												<div class="text">
													<h4>腾讯云服务</h4>
													<p>安全稳定，高弹性的计算机服务，给您提供更高效的体验</p>
													<p style="color: #2BC1FF;">
														￥<span class="price">688.00</span>
													</p>
												</div>
											</div>
										</div>

										<div class="pay">
											<span>共1件商品 需付款￥788.00</span>
											<a href="account.html">立即付款</a>
										</div>
									</div>
								</div>

							</div>
							<div class="swiper-slide list-group">
								<div class="list-group-item">
									<div class="order">
										<div class="order_info">
											<div class="left">
												<p>订单编号：<span>12345678</span></p>
												<p>下单时间：<span>2017-7-8</span></p>
											</div>
											<a class="right" href="javascript:;">等待付款</a>
											<div class="del">
												<img src="img/del.png" alt="" />
											</div>
										</div>
										<div class="pro_list">
											<div class="order_pro">
												<div class="img">
													<img src="img/1.png" alt="" />
												</div>

												<div class="text">
													<h4>腾讯云服务</h4>
													<p>安全稳定，高弹性的计算机服务，给您提供更高效的体验</p>
													<p style="color: #2BC1FF;">
														￥<span class="price">688.00</span>
													</p>
												</div>
											</div>
										</div>

										<div class="pay">
											<span>共1件商品 需付款￥788.00</span>
											<a href="account.html">立即付款</a>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="loadtip">上拉加载更多</div>
			<div class="swiper-scrollbar"></div>
		</div>
		<!--弹出窗-->
		<div class="top"></div>
		<div class="alter_content">
			<div class="content_top">
				<h3>提示</h3>
				<p>删除确定该订单？</p>
			</div>
			<div class="content_btn" style="line-height: 0.7rem;">
				<a style="border-right: 1px solid #c2c3c4;" id="cancel">取消</a>
				<a style="color: #7bbef8;" id="confirm">确定</a>
			</div>
		</div>
	</body>
	<script src="js/jquery-1.8.3.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/swiper-3.4.2.jquery.min.js"></script>
	<script src="js/cokie.js"></script>
	<!--<script src="js/order.js"></script>-->
	<script type="text/javascript">
		var loadFlag = true;
		var oi = 0;
		var mySwiper = new Swiper('.swiper-container', {
			direction: 'vertical',
			scrollbar: '.swiper-scrollbar',
			slidesPerView: 'auto',
			mousewheelControl: true,
			freeMode: true,
			onTouchMove: function(swiper) { //手动滑动中触发
				var _viewHeight = document.getElementsByClassName('swiper-wrapper')[0].offsetHeight;
				var _contentHeight = document.getElementsByClassName('swiper-slide')[0].offsetHeight;

				if(mySwiper.translate < 50 && mySwiper.translate > 0) {
					$(".init-loading").html('下拉刷新...').show();
				} else if(mySwiper.translate > 50) {
					$(".init-loading").html('释放刷新...').show();
				}
			},
			onTouchEnd: function(swiper) {
				var _viewHeight = document.getElementsByClassName('swiper-wrapper')[0].offsetHeight;
				var _contentHeight = document.getElementsByClassName('swiper-slide')[0].offsetHeight;
				// 上拉加载
				if(mySwiper.translate <= _viewHeight - _contentHeight - 50 && mySwiper.translate < 0) {
					// console.log("已经到达底部！");

					if(loadFlag) {
						$(".loadtip").html('正在加载...');
					} else {
						$(".loadtip").html('没有更多啦！');
					}
					$.ajax({
						type: "post",
						url: baseurl + "/order/search.json",
						data: { token: getCookie("token"), currentPage: 1, pageSize: 10 },
						success: function(data) {
							var orderData = data.datas.list;
							console.log(orderData);
							for(var i = 0; i < orderData.length; i++) {
								//时间戳转换日期
								var d = new Date(orderData[i].createTime);
								var Mo = d.getMonth() + 1;
								var D = d.getDate();
								var H = d.getHours();
								var Mi = d.getMinutes();
								var S = d.getSeconds();
								Mo = Mo >= 10 ? Mo : "0" + Mo;
								D = D >= 10 ? D : "0" + D;
								H = H >= 10 ? H : "0" + H;
								Mi = Mi >= 10 ? Mi : "0" + Mi;
								S = S >= 10 ? S : "0" + S;
								var day = (d.getFullYear()) + "-" + (Mo) + "-" + (D) + " " +
									(H) + ":" + (Mi) + ":" + (S);
								//确定订单状态
								var btn_text = "";
								var status = ""
								if(orderData[i].payStatus == 1) {
									status = "已完成";
									btn_text = "再次购买";
								} else {
									status = "等待付款";
									btn_text = "立即付款";
								}

								var html2 = '';
								for(var j = 0; j < orderData[i].productDetail.length; j++) {
									console.log(orderData[i].productDetail.length);
									html2 += '<div class="order_pro"><div class="img"><img src="' + orderData[i].productDetail[j].productThumbnail + '" alt="" /></div>' +
										'<div class="text"><h4>' + orderData[i].productDetail[j].productName + '</h4><p>' + orderData[i].productDetail[j].productDescribe + '</p>' +
										'<p style="color: #2BC1FF;">￥<span class="price">' + orderData[i].productDetail[j].productUnitPrice + '</span></p></div></div>';
								}
								var html1 = '';
								html1 += '<div class="order" id="' + orderData[i].id + '"><div class="order_info"><div class="left">' +
									'<p>订单编号：<span>' + orderData[i].orderNum + '</span></p><p>下单时间：<span>' + day + '</span></p></div>' +
									'<a class="right" href="javascript:;">' + status + '</a><div class="del"><img src="img/del.png" alt="" /></div></div><div class="pro_list">' + html2 + '</div>' +
									'<div class="pay"><span> 共' + orderData[i].productDetail.length + '件商品 需付款￥' + orderData[i].sumMoney + '</span><a  href="account.html?id=' + orderData[i].id + '">' + btn_text + '</a></div>';
								if(orderData[i].payStatus == 1) {
									$("#done_pay").append(html1);
								} else {
									$("#no_pay").append(html1);
								}
								$("#all").append(html1)

							};
						}
					});
					//              setTimeout(function() {
					//                  for(var i = 0; i <5; i++) {
					//                  	oi++;
					//                      $(".list-group").eq(mySwiper2.activeIndex).append('<li class="list-group-item">我是加载出来的'+oi+'...</li>');
					//                  }
					//                   $(".loadtip").html('上拉加载更多...');
					//                  mySwiper.update(); // 重新计算高度;
					//              }, 800);
				}

				// 下拉刷新
				if(mySwiper.translate >= 50) {
					$(".init-loading").html('正在刷新...').show();
					$(".loadtip").html('上拉加载更多');
					loadFlag = true;

					setTimeout(function() {
						$(".refreshtip").show(0);
						$(".init-loading").html('刷新成功！');
						setTimeout(function() {
							$(".init-loading").html('').hide();
						}, 800);
						$(".loadtip").show(0);

						//刷新操作
						mySwiper.update(); // 重新计算高度;
					}, 1000);
				} else if(mySwiper.translate >= 0 && mySwiper.translate < 50) {
					$(".init-loading").html('').hide();
				}
				return false;
			}
		});
		var mySwiper2 = new Swiper('.swiper-container2', {
			onTransitionEnd: function(swiper) {

				$('.w').css('transform', 'translate3d(0px, 0px, 0px)')
				$('.swiper-container2 .swiper-slide-active').css('height', 'auto').siblings('.swiper-slide').css('height', '0px');
				mySwiper.update();

				$('.o_tab li').eq(mySwiper2.activeIndex).addClass('active').siblings('li').removeClass('active');
			}

		});
		$('.o_tab li').click(function() {

			$(this).addClass('active').siblings('li').removeClass('active');
			mySwiper2.slideTo($(this).index(), 500, false)

			$('.w').css('transform', 'translate3d(0px, 0px, 0px)')
			$('.swiper-container2 .swiper-slide-active').css('height', 'auto').siblings('.swiper-slide').css('height', '0px');
			mySwiper.update();
		});
	</script>

</html>